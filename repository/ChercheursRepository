<?php 

namespace chercheurs\repository;
session_start();

use PDO;

class ChercheursRepository {

    static private array $config = [];
    static private ?ChercheursRepository $instance = null;
    private ?PDO $pdo = null;

    static public function setConfig($file): void
    {
        self::$config = parse_ini_file($file);
    }

    static public function getInstance(): ChercheursRepository
    {
        if (self::$instance === null) {
            self::$instance = new ChercheursRepository();
        }
        return self::$instance;
    }

    private function __construct()
    {
        if (!empty(self::$config)) {
            $driver = self::$config['driver'];
            $host = self::$config['host'];
            $database = self::$config['database'];
            $user = self::$config['username'];
            $pass = self::$config['password'];
            $dsn = "$driver:host=$host;dbname=$database";
            try {
                $this->pdo = new PDO($dsn, $user, $pass);
            } catch (\PDOException $e) {
                echo "pourquoi Ã§a marche paaaaaaaaaaaaaaaaaaas : " . $e->getMessage() . "<br>";
            }
        } else {
            echo "Config marche pas<br>";
        }
    }

    public function getArticle(string $nom, string $prenom){
        $stmt = $this->pdo->prepare("SELECT Titre
                                     from article
                                     inner join ecrire on article.NUMART = ecrire.NUMART
                                     inner join chercheur on ecrire.NUMCHER = chercheur.NUMCHER
                                     where chercheur.NOMCHERCHEUR = '?' and chercheur.PRENOMCHERCHEUR = '?';");
        
        $res = $stmt->execute([$nom, $prenom]);
        return $res;
    }

    public function getPDO(): ?PDO
    {
        return $this->pdo;
    }

}